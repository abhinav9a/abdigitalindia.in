<script>
	async function Capture() {
		const XML = '<?xml version="1.0"?><PidOptions ver="1.0"><Opts fCount="1" fType="2" iCount="0" pCount="0" format="0" pidVer="2.0" timeout="10000" posh="UNKNOWN" env="P" /></PidOptions>';
		const finUrl = "http://127.0.0.1:11100/rd/capture";

		try {
			const data = await $.ajax({
				type: "CAPTURE",
				url: finUrl,
				data: XML,
				contentType: "application/xml; charset=utf-8",
				dataType: "xml", // Specify that we expect XML in response
			});

			if (data && data.documentElement) {
				$("#data").val(new XMLSerializer().serializeToString(data));
				const errorcode = $(data).find("Resp").attr("errCode");
				if (errorcode == 0) {
					alert("Capture successful");
				} else {
					alert("Capture failed: " + $(data).find("Resp").attr("errInfo"));
				}
			} else {
				console.error("Invalid XML response:", data);
				$("#data").val("Received invalid data. Please check the console for details.");
				alert("Capture failed: Received invalid data from the device");
			}
		} catch (error) {
			console.error("Capture error:", error);
			$("#data").val("Error during capture. Please check the console for details.");
			alert("Capture failed: " + (error.statusText || "Unknown error occurred"));
		}
	}

	function captureFingerprint() {
		Capture();
	}
</script>
